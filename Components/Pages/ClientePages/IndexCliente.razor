@page "/clientes"
@inject VehiculosService VehiculosService
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager

<h3>Bienvenido, Cliente</h3>

<p>Selecciona una opción para continuar:</p>

<div class="container mt-4">
    <div class="row">
        <!-- Catálogo -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-body text-center">
                    <h5 class="card-title">Catálogo</h5>
                    <p class="card-text">Explora las categorías de vehículos disponibles.</p>
                    <button class="btn btn-primary" @onclick="IrACatalogo">Ver Catálogo</button>
                </div>
            </div>
        </div>

        <!-- Reservas -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-body text-center">
                    <h5 class="card-title">Mis Reservas</h5>
                    <p class="card-text">Consulta y gestiona tus reservas actuales.</p>
                    <button class="btn btn-primary" @onclick="IrAReservas">Ver Reservas</button>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private List<Vehiculo>? vehiculosDisponibles;
    private string NombreCliente = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity?.IsAuthenticated == true)
        {
            NombreCliente = user.Identity.Name ?? "Cliente";
            await CargarVehiculosDisponibles();
        }
    }

    private async Task CargarVehiculosDisponibles()
    {
        vehiculosDisponibles = await VehiculosService.ObtenerVehiculosDisponibles();
        vehiculosDisponibles = vehiculosDisponibles.Where(v => v.Disponible).ToList();
    }

    private void IrAReservas()
    {
        NavigationManager.NavigateTo("/reserva");
    }

    private void IrACatalogo()
    {
        NavigationManager.NavigateTo("/catalogo");
    }
}
