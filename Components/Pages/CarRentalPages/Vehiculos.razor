@* @page "/vehiculos"
@using CarRental.Models
@using CarRental.Services
@inject VehiculosService VehiculosService

<PageTitle>Gestión de Vehículos</PageTitle>

<h1>Gestión de Vehículos</h1>

@if (vehiculos is null)
{
    <p>Cargando vehículos...</p>
}
else
{
    <div>
        <button class="btn btn-primary" @onclick="MostrarFormularioCrear">Agregar Nuevo Vehículo</button>
    </div>

    @if (vehiculos.Count == 0)
    {
        <p>No hay vehículos registrados.</p>
    }
    else
    {
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Marca</th>
                    <th>Modelo</th>
                    <th>Año</th>
                    <th>Transmisión</th>
                    <th>Precio por Día</th>
                    <th>Disponible</th>
                    <th>Categoría</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var vehiculo in vehiculos)
                {
                    <tr>
                        <td>@vehiculo.VehiculoId</td>
                        <td>@vehiculo.Marca</td>
                        <td>@vehiculo.Modelo</td>
                        <td>@vehiculo.Año</td>
                        <td>@vehiculo.Transmision</td>
                        <td>@vehiculo.PrecioPorDia:C</td>
                        <td>@(vehiculo.Disponible ? "Sí" : "No")</td>
                        <td>@vehiculo.Categoria</td>
                        <td>
                            <button class="btn btn-warning btn-sm" @onclick="() => EditarVehiculo(vehiculo)">Editar</button>
                            <button class="btn btn-danger btn-sm" @onclick="() => EliminarVehiculo(vehiculo.VehiculoId)">Eliminar</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
}

@if (mostrarFormulario)
{
    <div class="mt-4">
        <h3>@((vehiculoSeleccionado is null ? "Crear" : "Editar")) Vehículo</h3>
        <EditForm Model="@vehiculoSeleccionado" OnValidSubmit="GuardarVehiculo">
            <DataAnnotationsValidator />
            <ValidationSummary />
            <div class="mb-3">
                <label>Marca:</label>
                <InputText @bind-Value="vehiculoSeleccionado.Marca" class="form-control" />
            </div>
            <div class="mb-3">
                <label>Modelo:</label>
                <InputText @bind-Value="vehiculoSeleccionado.Modelo" class="form-control" />
            </div>
            <div class="mb-3">
                <label>Año:</label>
                <InputNumber @bind-Value="vehiculoSeleccionado.Año" class="form-control" />
            </div>
            <div class="mb-3">
                <label>Transmisión:</label>
                <InputText @bind-Value="vehiculoSeleccionado.Transmision" class="form-control" />
            </div>
            <div class="mb-3">
                <label>Categoría:</label>
                <InputText @bind-Value="vehiculoSeleccionado.Categoria" class="form-control" />
            </div>
            <div class="mb-3">
                <label>Precio por Día:</label>
                <InputNumber @bind-Value="vehiculoSeleccionado.PrecioPorDia" class="form-control" />
            </div>
            <div class="mb-3">
                <label>Disponible:</label>
                <InputCheckbox @bind-Value="vehiculoSeleccionado.Disponible" class="form-check-input" />
            </div>
            <div class="mb-3">
                <label>Número de Placa:</label>
                <InputText @bind-Value="vehiculoSeleccionado.NumeroPlaca" class="form-control" />
            </div>
            <div class="mb-3">
                <label>Kilometraje:</label>
                <InputNumber @bind-Value="vehiculoSeleccionado.Kilometraje" class="form-control" />
            </div>
            <div class="mb-3">
                <label>Color:</label>
                <InputText @bind-Value="vehiculoSeleccionado.Color" class="form-control" />
            </div>
            <button type="submit" class="btn btn-success">Guardar</button>
            <button type="button" class="btn btn-secondary" @onclick="CancelarFormulario">Cancelar</button>
        </EditForm>
    </div>
}

@code {
    private List<Vehiculos>? vehiculos;
    private Vehiculos? vehiculoSeleccionado;
    private bool mostrarFormulario = false;

    protected override async Task OnInitializedAsync()
    {
        await CargarVehiculos();
    }

    private async Task CargarVehiculos()
    {
        vehiculos = await VehiculosService.ObtenerVehiculos();
    }

    private void MostrarFormularioCrear()
    {
        vehiculoSeleccionado = new Vehiculos();
        mostrarFormulario = true;
    }

    private void EditarVehiculo(Vehiculos vehiculo)
    {
        vehiculoSeleccionado = vehiculo;
        mostrarFormulario = true;
    }

    private async Task GuardarVehiculo()
    {
        if (vehiculoSeleccionado is null) return;

        if (vehiculoSeleccionado.VehiculoId == 0)
        {
            await VehiculosService.CrearVehiculo(vehiculoSeleccionado);
        }
        else
        {
            await VehiculosService.ActualizarVehiculo(vehiculoSeleccionado);
        }

        mostrarFormulario = false;
        await CargarVehiculos();
    }

    private async Task EliminarVehiculo(int id)
    {
        var confirm = await jsRuntime.InvokeAsync<bool>("confirm", $"¿Estás seguro de que deseas eliminar el vehículo con ID {id}?");
        if (confirm)
        {
            await VehiculosService.EliminarVehiculo(id);
            await CargarVehiculos();
        }
    }

    private void CancelarFormulario()
    {
        vehiculoSeleccionado = null;
        mostrarFormulario = false;
    }
}
 *@